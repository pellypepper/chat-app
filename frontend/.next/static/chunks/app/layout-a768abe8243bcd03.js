(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},1231:(e,t,n)=>{"use strict";n.d(t,{F:()=>a,c:()=>i});var r=n(5155),l=n(2115),s=n(4298);let o=(0,l.createContext)({socket:null,socketConnected:!1}),i=()=>(0,l.useContext)(o),a=e=>{let{userId:t,children:n}=e,[i,a]=(0,l.useState)(!1),u=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(t)return u.current&&(u.current.disconnect(),u.current=null),u.current=(0,s.Ay)("http://localhost:4000",{query:{userId:t.toString()},transports:["websocket","polling"],autoConnect:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5,timeout:2e4}),u.current.on("connect",()=>a(!0)),u.current.on("disconnect",()=>a(!1)),u.current.on("connect_error",()=>a(!1)),()=>{u.current&&(u.current.disconnect(),u.current=null)}},[t]),(0,r.jsx)(o.Provider,{value:{socket:u.current,socketConnected:i},children:n})}},2840:(e,t,n)=>{Promise.resolve().then(n.bind(n,6903))},4385:(e,t,n)=>{"use strict";n.d(t,{n:()=>o});var r=n(5453),l=n(3464),s=n(6786);l.A.defaults.withCredentials=!0,l.A.defaults.baseURL="https://chat-app-tk-blg.fly.dev";let o=(0,r.v)()((0,s.lt)(e=>({user:null,isAuthenticated:!1,isLoading:!1,error:null,getSession:async()=>{var t,n;try{let n=(await l.A.get("/login/user",{withCredentials:!0})).data.user;e({user:n,isAuthenticated:null==(t=null==n?void 0:n.verified)||t,isLoading:!1,error:null})}catch(t){try{await l.A.post("/login/refresh",{},{withCredentials:!0});let t=(await l.A.get("/login/user",{withCredentials:!0})).data.user;e({user:t,isAuthenticated:null==(n=null==t?void 0:t.verified)||n,isLoading:!1,error:null})}catch(t){e({user:null,isAuthenticated:!1,error:"Session expired"})}}},login:async t=>{var n,r,s,o;let{email:i,password:a}=t;e({isLoading:!0,error:null});try{let t=await l.A.post("/login",{email:i,password:a});e({user:t.data.user,isAuthenticated:null!=(r=null==(n=t.data.user)?void 0:n.verified)&&r})}catch(t){e({error:(null==(o=t.response)||null==(s=o.data)?void 0:s.message)||t.message})}finally{e({isLoading:!1})}},googleLogin:()=>{window.location.href="login/google"},logout:async()=>{e({isLoading:!0,error:null});try{await l.A.post("/login/logout"),e({user:null,isAuthenticated:!1,error:null})}catch(r){var t,n;e({error:(null==(n=r.response)||null==(t=n.data)?void 0:t.message)||r.message})}finally{e({isLoading:!1})}},reset:()=>e({user:null,isLoading:!1,error:null})})))},6903:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=n(5155);n(347);var l=n(2115),s=n(1231),o=n(4385);function i(e){let{children:t}=e,[n,i]=(0,l.useState)(!1);(0,l.useMemo)(()=>({isOpen:n,open:()=>i(!0),close:()=>i(!1)}),[n]);let{user:a}=(0,o.n)();return(0,r.jsx)("html",{lang:"en",className:"scroll-smooth",children:(0,r.jsx)("body",{children:(0,r.jsx)(s.F,{userId:null==a?void 0:a.id,children:t})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[690,655,298,441,684,358],()=>t(2840)),_N_E=e.O()}]);